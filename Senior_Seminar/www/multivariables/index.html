<!DOCTYPE html>
<html>
    <head>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
        <title>Sara's Homepage</title>
        <link rel="stylesheet" type="text/css" href="css/style.css"/>
        <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
        <script type="text/javascript" src="js/style.js"></script>
        <script type="text/javascript" src="http://d3js.org/d3.v3.min.js"></script>
        <script src="js/jquery.tipsy.js" type="text/javascript" charset="utf-8"></script>
        <link rel="stylesheet" href="http://onehackoranother.com/projects/jquery/tipsy/stylesheets/tipsy.css" type="text/css" title="no title" charset="utf-8"/>
        <style>
            body {
              font: 11px sans-serif;
            }

            .axis path,
            .axis line {
              fill: none;
              stroke: #000;
              shape-rendering: crispEdges;
            }

            .dot {
              stroke: #000;
            }

            .tooltip {
              position: absolute;
              width: 200px;
              height: 28px;
              pointer-events: none;
            }
        </style>
    </head>
    <body>
        <div class="wrapper">
            <div id="centered">
                <h1><a href="COMP401/">Sports Data</a></h1>
                
                <div id="content">
                    <div class="content-wrapper" id="content-multivariable">
                        <div id="viz" width = "600" height="600"></div>
                    </div>

                    <div class="section-left">
                        <br>X-axis:
                        <select class="options" id="x">
                            <option value="Height" selected>Height</option>
                            <option value="Weight">Weight</option>
                            <option value="Average">Average</option>
                            <option value="OBP">OBP</option>
                            <option value="Homeruns">Home runs</option>
                        </select>
                        <br>Y-axis:
                        <select class="options" id="y">
                            <option value="Height">Height</option>
                            <option value="Weight" selected>Weight</option>
                            <option value="Average">Average</option>
                            <option value="OBP">OBP</option>
                            <option value="Homeruns">Home runs</option>
                        </select>
                        <br>Circle size:
                        <select class="options" id="circleRadius">
                            <option value="Height">Height</option>
                            <option value="Weight">Weight</option>
                            <option value="Average" selected>Average</option>
                            <option value="OBP">OBP</option>
                            <option value="Homeruns">Home runs</option>
                        </select>
                        <br>Circle color:
                        <select class="options" id="circleColor">
                            <option value="Height">Height</option>
                            <option value="Weight">Weight</option>
                            <option value="Average">Average</option>
                            <option value="OBP" selected>OBP</option>
                            <option value="Homeruns">Home runs</option>
                        </select>
                        
                        <hr>
                        <button id="apply">Apply Changes</button>
                    </div>
                </div>
                <!-- set up a button -->
                
            </div>
        </div>

        <script type="text/javascript">
    // set the stage
    var margin = {t:30, r:20, b:20, l:40 },
        w = 600 - margin.l - margin.r,
        h = 500 - margin.t - margin.b,
        x = d3.scale.linear().range([0, w]),
        y = d3.scale.linear().range([h - 60, 0]),
        //colors that will reflect geographical regions
        color = d3.scale.category10();

    var svg = d3.select("#viz").append("svg")
        .attr("width", w + margin.l + margin.r)
        .attr("height", h + margin.t + margin.b);

    // set axes, as well as details on their ticks
    var xAxis = d3.svg.axis()
        .scale(x)
        .ticks(20)
        .tickSubdivide(true)
        .tickSize(6, 3, 0)
        .orient("bottom");

    var yAxis = d3.svg.axis()
        .scale(y)
        .ticks(20)
        .tickSubdivide(true)
        .tickSize(6, 3, 0)
        .orient("left");

    // group that will contain all of the plots
    var groups = svg.append("g").attr("transform", "translate(" + margin.l + "," + margin.t + ")");

    // get input options
    function getOptions() {
        var optionX = $("#x").val();
        var optionY = $("#y").val();
        var optionR = $("#circleRadius").val();
        var optionC = $("#circleColor").val();

        return {"optionX": optionX, "optionY": optionY, "optionR":optionR, "optionC": optionC};
    }

    var players = [];

    // bring in the data, and do everything that is data-driven
    d3.xml("data/sportsData.xml", function(data) {
        // array of the players, used for the legend
        var xml = $('baseball', data);
        // console.log(xml);


        xml.find("player").each(function() {
            temp = {};
            temp["Name"] = $(this).find("name").text();
            temp["Height"] = $(this).find("height").text();
            temp["Weight"] = $(this).find("weight").text();
            temp["Average"] = $(this).find("average").text();
            temp["OBP"] = $(this).find("OBP").text();
            temp["Homeruns"] = $(this).find("home_runs").text();
            temp["Team"] = $(this).prev().text();
            players.push(temp);
        });
    });

    function getGraph(){
        var options = getOptions();
        console.log(options);
        console.log(players);

        // sort data alphabetically by region, so that the colors match with legend
        players.sort(function(a, b) { return d3.ascending(options.colors, options.colors); })

        // var x0 = Math.max(-d3.min(players, function(d) { return d.optionX; }), d3.max(players, function(d) { return d.optionX; }));

        // var x = d3.scale.linear()
        //     .range([0, width])
        //     .domain(xextent).nice();

        // var xAxis = d3.svg.axis()
        //     .scale(x)
        //     .orient("bottom");

        var xDomain = d3.extent(players, function(d) { 
            return d[options.optionX]; 
        });
        x.domain([xDomain[0] * 0.95, xDomain[1] * 1.05]).nice();

        var yDomain = d3.extent(players, function(d) { 
            return d[options.optionY]; 
        });
        y.domain([yDomain[0] * 0.95, yDomain[1] * 1.05]).nice();

        var rDomain = d3.extent(players, function(d) { 
            return d[options.optionR]; 
        });
        var r = d3.scale.linear()
            .range([5, 20])
            .domain([rDomain[0] * 0.95, rDomain[1] * 1.05]).nice();
        console.log(rDomain);
        console.log(r);

        // style the circles, set their locations based on data
        var circles = groups.selectAll("circle")
            .data(players)
            .enter().append("circle")
            .attr("class", "circles")
            .attr({
                cx: function(d) { 
                    return x(+d[options.optionX]); 
                },
                cy: function(d) { return y(+d[options.optionY]); },
                r: function(d) { return r(+d[options.optionR]); },
                id: function(d) { return d.Name; }
            })
            .style("fill", function(d) { return color(d[options.optionC]); });

        // // what to do when we mouse over a bubble
        // var mouseOn = function() { 
        //     var circle = d3.select(this);

        //     // transition to increase size/opacity of bubble
        //     circle.transition()
        //         .duration(800).style("opacity", 1)
        //         .attr("r", 16).ease("elastic");

        //     // append lines to bubbles that will be used to show the precise data points.
        //     // translate their location based on margins
        //     svg.append("g")
        //         .attr("class", "guide")
        //         .append("line")
        //         .attr("x1", circle.attr("cx"))
        //         .attr("x2", circle.attr("cx"))
        //         .attr("y1", +circle.attr("cy") + 26)
        //         .attr("y2", h - margin.t - margin.b)
        //         .attr("transform", "translate(40,20)")
        //         .style("stroke", circle.style("fill"))
        //         .transition().delay(200).duration(400)
        //         .styleTween("opacity", function() { return d3.interpolate(0, .5); })

        //     svg.append("g")
        //         .attr("class", "guide")
        //         .append("line")
        //         .attr("x1", +circle.attr("cx") - 16)
        //         .attr("x2", 0)
        //         .attr("y1", circle.attr("cy"))
        //         .attr("y2", circle.attr("cy"))
        //         .attr("transform", "translate(40,30)")
        //         .style("stroke", circle.style("fill"))
        //         .transition().delay(200).duration(400)
        //         .styleTween("opacity", function() { return d3.interpolate(0, .5); });

        //     // function to move mouseover item to front of SVG stage, in case
        //     // another bubble overlaps it
        //     d3.selection.prototype.moveToFront = function() { 
        //         return this.each(function() { 
        //             this.parentNode.appendChild(this); 
        //         }); 
        //     };

        //     // skip this functionality for IE9, which doesn't like it
        //     if (!$.browser.msie) {
        //         circle.moveToFront();   
        //     }
        // };


        // // what happens when we leave a bubble?
        // var mouseOff = function() {
        //     var circle = d3.select(this);

        //     // go back to original size and opacity
        //     circle.transition()
        //         .duration(800).style("opacity", .5)
        //         .attr("r", 8).ease("elastic");

        //     // fade out guide lines, then remove them
        //     d3.selectAll(".guide").transition().duration(100)
        //         .styleTween("opacity", function() { return d3.interpolate(.5, 0); })
        //         .remove()
        // };

        // // run the mouseon/out functions
        // circles.on("mouseover", mouseOn);
        // circles.on("mouseout", mouseOff);

        // // tooltips (using jQuery plugin tipsy)
        // circles.append("title").text(function(d) { return d.country; })

        // $(".circles").tipsy({ gravity: 's', });

        // // the legend color guide
        // var legend = svg.selectAll("rect")
        //     .data(regions)
        //     .enter().append("rect")
        //     .attr({
        //         x: function(d, i) { return (40 + i*80); },
        //         y: h,
        //         width: 25,
        //         height: 12
        //     })
        //     .style("fill", function(d) { return color(d); });


        // // legend labels    
        // svg.selectAll("text")
        //     .data(regions)
        //     .enter().append("text")
        //     .attr({
        //         x: function(d, i) { return (40 + i*80); },
        //         y: h + 24,
        //     })
        //     .text(function(d) { return d; });

        // // draw axes and axis labels
        // svg.append("g")
        //     .attr("class", "x axis")
        //     .attr("transform", "translate(" + margin.l + "," + (h - 60 + margin.t) + ")")
        //     .call(xAxis);

        // svg.append("g")
        //     .attr("class", "y axis")
        //     .attr("transform", "translate(" + margin.l + "," + margin.t + ")")
        //     .call(yAxis);

        // svg.append("text")
        //     .attr("class", "x label")
        //     .attr("text-anchor", "end")
        //     .attr("x", w + 50)
        //     .attr("y", h - margin.t - 5)
        //     .text("others in society seen as trustworthy*");

        // svg.append("text")
        //     .attr("class", "y label")
        //     .attr("text-anchor", "end")
        //     .attr("x", -20)
        //     .attr("y", 45)
        //     .attr("dy", ".75em")
        //     .attr("transform", "rotate(-90)")
        //     .text("ease of doing business (rank)");

    }

    $("#apply").click(function(){
        getGraph();
    })

    getGraph();

</script>

        


    </body>
</html>